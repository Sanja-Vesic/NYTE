<!doctype html>
<html lang="en">
  <head>
     <meta charset="UTF-8" />
    <title>NYT Explorer</title>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"> </script>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
   
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
  </head>
  <body>
    <h1>NYT Explorer</h1>
    <p>Year:</p>
    <input type="text" id="year" value="2018">
    <p>Month:</p>
    <input type="text" id="month" value="2">
    <br/>
     <button onclick="find()">Find</button>
   <div id="root">
    </div>



    <script type="text/babel">
      class App extends React.Component { 

            constructor(props){
                super(props)
                this.state = {
                  data: [],
                  selectedArticle: []
                };
                this.setData = this.setData.bind(this);
                this.handleTableRowClick = this.handleTableRowClick.bind(this);
            }

         handleTableRowClick(item){
                console.log("ITEM: " + item);
                this.setState({selectedArticle: item})
                 
            }


            setData(responseData){
               
                const doc = responseData.response.docs.slice(0,1);
               
            
             this.setState({data: doc});
        }
            
      componentDidMount(){

      console.log('componentDidMount');

       $.ajax({
            
            url: 'https://api.nytimes.com/svc/archive/v1/'+$('#year').val()+'/'+$('#month').val()+'.json?api-key=02a32004d52545be9c4e7b6f0b3edc28',
          
            success: this.setData
        })

    }
  
       
        render(){ 
           
   
        if(this.state.data.length ==0){
                   
                  
        return  <img className="bb" src="./demo1.gif" ></img>;
                }
      
        return (
        <div>
          <div>
            {
            this.state.data.map( (article) => <Article key={article.web_url} url={article.web_url} clickhandler={this.handleTableRowClick} item={article}/> )
            }
          </div>
          <div className="details">
            <UserDetails user={this.state.selectedArticle}/>
          </div>
        </div>
        );
    }
      }  

      const UserDetails=(props)=> {
      const user=props.user;
      
            return (
                <div>
                   <pre>{JSON.stringify(user)}</pre>
                </div>
            );
        }

   
  
          

   class Article extends React.Component {

    constructor(props){
      super(props)
      this.state = {data: {}};
      this.setData = this.setData.bind(this)

    }

    setData(responseData){
    this.setState({data: responseData}); 
    }   

 componentDidMount(){
       $.ajax({
            
            
           /* url: 'http://api.linkpreview.net/?key=5a8c5fffdf1fd0d14e3ef9e05269b449abdfcf5c8c60a&q=' + this.props.url,*/
          url: 'http://api.linkpreview.net/?key=123456&q=https://www.google.com',
            success: this.setData
        })

    }
    
    render(){
   const data = this.props.item;
      console.log("ARTICLE RENDER: " + data);
   const clickhandler = this.props.clickhandler;  
 
      return (
      <section>
        <div className="flex-container"  >
                       
              
          <img className="aa" src={this.state.data.image} width="100" onClick={() => clickhandler(data)} ></img>
          <h3>{this.state.data.title}</h3>
          <p>{this.state.data.description}</p>
          
          {/*<p>MORE AT:
            <a href={this.state.data.url}>{this.state.data.url}</a>
          </p>*/}
        </div>
        
        </section>
      );
    }
      
}




  function find(){
        app.componentDidMount();
  }    

  var app = ReactDOM.render(<App/>, document.getElementById('root')) 
    </script>
  </body>
</html>
